namespace WebApi.Common;

public static class PromptTemplates
{
    public static string BuildGenerationPrompt(string question, string lang = "Русский")
    {
        return $@"
Ты — ассистент, который создаёт четыре разных ответа на один и тот же вопрос,
чтобы тренировать критическое мышление.

Язык ответа: совпадает с языком вопроса. 
Если вопрос на русском — отвечай по-русски.

Вопрос:
{question}

СФОРМИРУЙ СТРОГИЙ JSON с массивом ""answers"". Каждый элемент массива должен содержать:
- ""level"": одно из значений [""low"", ""low"", ""medium"", ""high""].
  В сумме в массиве должно быть ровно ДВА ""low"", ОДИН ""medium"" и ОДИН ""high"".
- ""score"": 50 для ""low"", 75 для ""medium"", 100 для ""high"".
- ""text"": текст ответа (уникальный; без повторения формулировок; подходящий по стилю для языка: {lang}).

Ограничения:
- Все четыре ответа должны отличаться глубиной и ходом рассуждений.
- Не добавляй никакого текста вне JSON (никаких пояснений до или после).

Пример формата (это только пример структуры, НЕ используй его текст):
{{""answers"":[
  {{""level"":""low"",""score"":50,""text"":""...""}},
  {{""level"":""low"",""score"":50,""text"":""...""}},
  {{""level"":""medium"",""score"":75,""text"":""...""}},
  {{""level"":""high"",""score"":100,""text"":""...""}}
]}}
";
    }

    public static string BuildEvaluationPrompt(
        string question,
        string studentAnswer,
        IEnumerable<(string level, int score, string text)> golds,
        string lang = "Русский")
    {
        return $@"
Ты — беспристрастный проверяющий ответов по критическому мышлению для учеников средней школы.

Задача:
Оценить ответ ученика на вопрос, используя набор эталонных ответов разного уровня.

Вопрос:
{question}

Ответ ученика:
{studentAnswer}

Эталонный набор (четыре ответа с уровнями и базовыми баллами):
{string.Join("\n\n", golds.Select(g => $"- level: {g.level}, score: {g.score}\ntext: {g.text}"))}

Политика оценивания (СТРОГО):
1. Сначала выбери, какому одному уровню из эталонов ближе всего ответ ученика:
   - low  (базовый балл 50),
   - medium (базовый балл 75),
   - high (базовый балл 100).
2. Установи базовый балл: 50, 75 или 100, в зависимости от выбранного уровня.
3. Затем за счёт нюансов (ясность, аргументация, структура, примеры) добавь поправку —
   целое число в диапазоне от -5 до +5.
4. Итоговый балл = base + adjustment.
   После этого зажми итог в диапазоне 0..100.

Типичные диапазоны:
- если уровень ""low"" → обычно 50..55,
- если уровень ""medium"" → обычно 70..80 (центр 75),
- если уровень ""high"" → обычно 95..100 (или 90..100, если чуть слабее).

Требуемые задачи:
1) Кратко обосновать выбранный уровень (не больше 3 предложений).
2) Выделить сильные стороны ответа (2 пункта-списка).
3) Дать конкретные рекомендации по улучшению (минимум 3 пункта-списка).
4) Написать короткий абзац ""advice"" с общими следующими шагами для ученика.

ФОРМАТ ВЫВОДА — СТРОГИЙ JSON (никакого текста снаружи). Структура:

{{
  ""match_level"": ""low"" | ""medium"" | ""high"",
  ""base"": 50 | 75 | 100,
  ""adjustment"": целое число от -5 до 5,
  ""score"": целое число от 0 до 100,
  ""rationale"": ""до 3 предложений"",
  ""strengths"": [""пункт 1"", ""пункт 2""],
  ""recommendations"": [""действие 1"", ""действие 2"", ""действие 3""],
  ""advice"": ""короткий абзац советов""
}}

Язык вывода:
- Совпадает с языком ответа ученика.
- Если язык ответа неочевиден — используй язык вопроса.
- Но значения полей match_level, base, adjustment, score должны быть в формате, описанном выше.
";
    }

    public static string BuildConspectPrompt(
        string title,
        IEnumerable<string> questions,
        string lang = "Русский")
    {
        var q = string.Join("\n- ", questions ?? Array.Empty<string>());

        return $@"
Ты — учитель средней школы. Составь понятный и структурированный конспект урока по теме ниже.
Язык конспекта: {lang}. Стиль: простой, ясный, ориентированный на практику.

Тема: {title}

Вопросы, которые нужно обязательно покрыть:
- {q}

Требования к конспекту (вывод ТОЛЬКО текст, без JSON):
- 6–10 коротких разделов с заголовками.
- Дай ключевые определения, краткие примеры, типичные ошибки и заблуждения.
- Вставь по ходу текста небольшие вопросы для самопроверки (формата ""попробуй ответить..."").
- В конце добавь 3–5 конкретных и понятных советов, как лучше освоить тему.

Не добавляй никаких мета-комментариев вроде ""Вот ваш конспект"" и не используй JSON.
Только сам текст конспекта.
";
    }
}